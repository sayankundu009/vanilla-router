!function(){"use strict";const t=new RegExp(/:[^\s/]+/g);function e(t){try{t()}catch(t){console.error("[vanilla-router] ",t.message)}}function r(t){return new RegExp("^"+t.replace(/:[^\s/]+/g,"((?:[^/]+?))")+"$")}class i extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.checkIfAlreadyExists(),this.shadowRoot.innerHTML="<slot></slot>",window.__vanilla_router_view__=this}checkIfAlreadyExists(){e((()=>{if(window.__vanilla_router_view__)throw Error("Router View already exists")}))}}window.customElements.define("router-view",i);class s extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._$a=null}connectedCallback(){this.to&&this.addEventListener("click",(t=>{console.log("Go to: ",this.to)}))}connectedCallback(){this.path=this.getAttribute("to")||"",this.shadowRoot.innerHTML=`<a href="#${this.path}">${this.innerHTML}</a>`,this._$a=this.shadowRoot.querySelector("a"),this.attachAttributes(),this._$a.addEventListener("click",(t=>{t.preventDefault(),this.redirect()})),this.parentElement.insertBefore(this._$a,this),this.remove()}attachAttributes(){[...this.attributes].forEach((t=>{this._$a.setAttribute(t.name,t.value)})),this._$a.removeAttribute("to")}get observedAttributes(){return["class","style"]}attributeChangedCallback(t,e,r){this._$a.setAttribute(t,r)}get $router(){return window.__vanilla_router__}redirect(){this.$router&&"redirect"in this.$router&&this.$router.redirect(this.path)}}window.customElements.define("router-link",s);class o{constructor(){window.addEventListener("hashchange",this.onHashChange.bind(this))}getRouter(){return window.__vanilla_router__}currentHash(){return window.location.hash.substring(1)}currentPath(){return this.currentHash().split("?")[0]}currentQueryString(){return this.currentHash().split("?")[1]}fullPath(){return window.location.href}getRoute(){return new URL(this.fullPath())}getQueryParams(){const t=new URLSearchParams(this.currentQueryString()),e={};for(var r of t.keys())e[r]=t.get(r);return e}getPathParams(){const e=this.getRouter().activeRoute,i={};if(!e||e.fast_star)return i;const s=r(e.path),o=t;let a=this.currentPath().match(s),n=e.path.match(o),h=a?a.splice(1):[];return n&&n.forEach(((t,e)=>{let r=h[e];r=function(t){return/^-?\d+$/.test(t)}(r)?Number(r):String(r),i[t.replace(":","")]=r})),i}replace(t){location.hash=t}get $route(){return{fullPath:this.fullPath(),path:this.currentPath(),query:this.getQueryParams(),params:this.getPathParams()}}onRouteChange(t){this.routeChangeCallBack=t}onHashChange(){"function"==typeof this.routeChangeCallBack&&this.routeChangeCallBack(this.$route)}triggerRouteChange(){this.onHashChange()}start(){this.currentPath()?this.triggerRouteChange():this.replace("/")}}window.VanillaRouter=class{constructor({mode:t="hash",routes:e}){this.checkIfAlreadyExists(),this.mode=t,this.routes=e,this.initializeNavigator(),this.initializeTemplates(),this.initializeRouterComponents(),window.__vanilla_router__=this,window.$router=this.getRouterProperties(),this.$navigator.start()}checkIfAlreadyExists(){e((()=>{if(window.__vanilla_router__)throw Error("Router already exists")}))}checkMode(){["history","hash"].includes(this.mode)||(this.mode="hash")}initializeNavigator(){switch(this.checkMode(),this.mode){case"hash":this.$navigator=new o}this.$navigator.onRouteChange((()=>{this.onRouteChange()}))}initializeTemplates(){const t=document.querySelectorAll("body > template[page]"),e=new Map;t.forEach((t=>{let r=(t.getAttribute("page")??"").trim();r&&e.set(r,t)})),this.routerTemplates=e}initializeRouterComponents(){this.routerComponents=new Map,Object.entries(this.routes).forEach((([t,e])=>{const i=(e.page??"").trim();if(i){const e=this.routerTemplates.get(i),s="*"===t,o=s?null:r(t);this.routerComponents.set(t,{path:t,pathRegex:o,template:e,alise:i,fast_star:s})}}))}setCurrentRoute(){this.activeRoute={}}checkIfActiveRoute(t){return t.alise===this.activeRoute?.alise}get routerView(){return window.__vanilla_router_view__}getRouteMatch(t){for(let[e,r]of this.routerComponents)if(!r.fast_star&&t.match(r.pathRegex))return r;return this.routerComponents.get("*")||null}show(t=null){let e=this.getRouteMatch(t);if(e){this.activeRoute=e;const{template:t}=e;this.render(t)}}clearRouterView(){if(this.routerView)for(;this.routerView.firstChild;)this.routerView.removeChild(this.routerView.lastChild)}render(t){if(this.routerView&&t){this.clearRouterView();const i=t.content.cloneNode(!0);r=[...i.querySelectorAll("script")],e((()=>{r.forEach((t=>{t.text=`(function vnlr(){${t.text}})()`}))})),this.routerView.appendChild(i)}var r}redirect(t="/",e={}){const r=function(t){let e="?";return Object.entries(t).forEach((([t,r])=>{e+=`${t}=${r}&`})),e=e.slice(0,-1),1==e.length&&(e=""),e}(e);this.$navigator.replace(t+r)}onRouteChange(){const t=this.$navigator.currentPath();this.show(t),console.log(this.$navigator.$route)}getRouterProperties(){const t=this;return{get route(){return t.$navigator.$route},redirect:t.redirect.bind(t)}}}}();
