!function(){"use strict";function t(t){try{t()}catch(t){console.error("[vanilla-router] ",t.message)}}class e extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.checkIfAlreadyExists(),this.shadowRoot.innerHTML="<slot></slot>",window.__vanilla_router_view__=this}checkIfAlreadyExists(){t((()=>{if(window.__vanilla_router_view__)throw Error("Router View already exists")}))}}window.customElements.define("router-view",e);class r extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._$a=null}connectedCallback(){this.to&&this.addEventListener("click",(t=>{console.log("Go to: ",this.to)}))}connectedCallback(){this.path=this.getAttribute("to")||"",this.shadowRoot.innerHTML=`<a href="#${this.path}">${this.innerHTML}</a>`,this._$a=this.shadowRoot.querySelector("a"),this.attachAttributes(),this._$a.addEventListener("click",(t=>{t.preventDefault(),this.redirect()})),this.parentElement.insertBefore(this._$a,this),this.remove()}attachAttributes(){[...this.attributes].forEach((t=>{this._$a.setAttribute(t.name,t.value)})),this._$a.removeAttribute("to")}get observedAttributes(){return["class","style"]}attributeChangedCallback(t,e,r){this._$a.setAttribute(t,r)}get $router(){return window.__vanilla_router__}redirect(){this.$router&&"redirect"in this.$router&&this.$router.redirect(this.path)}}window.customElements.define("router-link",r);class i{constructor(){window.addEventListener("hashchange",this.onHashChange.bind(this))}getRouter(){return window.__vanilla_router__}currentHash(){return window.location.hash.substring(1)}currentPath(){return this.currentHash().split("?")[0]}currentQueryString(){return this.currentHash().split("?")[1]}fullPath(){return window.location.href}getRoute(){return new URL(this.fullPath())}getQueryParams(){const t=new URLSearchParams(this.currentQueryString()),e={};for(var r of t.keys())e[r]=t.get(r);return e}getPathParams(){const t=this.getRouter().activeRoute,e={};if(!t)return e;let r=new RegExp("^"+t.path.replace(/:[^\s/]+/g,"([\\w-]+)")+"$");const i=new RegExp(/:[^\s/]+/g);let s=this.currentPath().match(r),o=t.path.match(i),a=s?s.splice(1):[];return o&&o.forEach(((t,r)=>{let i=a[r];i=function(t){return/^-?\d+$/.test(t)}(i)?Number(i):String(i),e[t.replace(":","")]=i})),e}replace(t){location.hash=t}get $route(){return{fullPath:this.fullPath(),path:this.currentPath(),query:this.getQueryParams(),params:this.getPathParams()}}onRouteChange(t){this.routeChangeCallBack=t}onHashChange(){"function"==typeof this.routeChangeCallBack&&this.routeChangeCallBack(this.$route)}triggerRouteChange(){this.onHashChange()}start(){this.currentPath()?this.triggerRouteChange():this.replace("/")}}window.VanillaRouter=class{constructor({mode:t="hash",routes:e}){this.checkIfAlreadyExists(),this.mode=t,this.routes=e,this.initializeNavigator(),this.initializeTemplates(),this.initializeRouterComponents(),window.__vanilla_router__=this,window.$router=this.getRouterProperties(),this.$navigator.start()}checkIfAlreadyExists(){t((()=>{if(window.__vanilla_router__)throw Error("Router already exists")}))}checkMode(){["history","hash"].includes(this.mode)||(this.mode="hash")}initializeNavigator(){switch(this.checkMode(),this.mode){case"hash":this.$navigator=new i}this.$navigator.onRouteChange((()=>{this.onRouteChange()}))}initializeTemplates(){const t=document.querySelectorAll("body > template[page]"),e=new Map;t.forEach((t=>{let r=(t.getAttribute("page")??"").trim();r&&e.set(r,t)})),this.routerTemplates=e}initializeRouterComponents(){this.routerComponents=new Map,Object.entries(this.routes).forEach((([t,e])=>{const r=(e.page??"").trim();if(r){const e=this.routerTemplates.get(r),i=new RegExp("^"+t.replace(/:[^\s/]+/g,"([\\w-]+)")+"$");this.routerComponents.set(t,{path:t,pathRegex:i,template:e,alise:r})}}))}setCurrentRoute(){this.activeRoute={}}checkIfActiveRoute(t){return t.alise===this.activeRoute?.alise}get routerView(){return window.__vanilla_router_view__}getRouteMatch(t){for(let[e,r]of this.routerComponents)if(t.match(r.pathRegex))return r;return null}show(t=null){let e=this.getRouteMatch(t);if(e){this.activeRoute=e;const{template:t}=e;this.render(t)}}clearRouterView(){if(this.routerView)for(;this.routerView.firstChild;)this.routerView.removeChild(this.routerView.lastChild)}render(e){if(this.routerView&&e){this.clearRouterView();const i=e.content.cloneNode(!0);r=[...i.querySelectorAll("script")],t((()=>{r.forEach((t=>{t.text=`(function vnlr(){${t.text}})()`}))})),this.routerView.appendChild(i)}var r}redirect(t="/",e={}){const r=function(t){let e="?";return Object.entries(t).forEach((([t,r])=>{e+=`${t}=${r}&`})),e=e.slice(0,-1),1==e.length&&(e=""),e}(e);this.$navigator.replace(t+r)}onRouteChange(){console.log(this.$navigator.$route);const{path:t}=this.$navigator.$route;this.show(t)}getRouterProperties(){const t=this;return{get route(){return t.$navigator.$route},redirect:t.redirect.bind(t)}}}}();
